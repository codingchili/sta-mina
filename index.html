<!doctype html>
<html>
<script>
    function download(callback, resource) {
        let xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState === 4 && this.status === 200) {
                callback(xhttp.responseText);
            }
        };
        xhttp.open("GET", resource, true);
        xhttp.send();
    }

    function loaded(content) {
        this.data = content.data || this.data;
        this.template = content.template || this.template;

        if (this.data != null && this.template != null) {
            let {theme, text, contact, external, seo} = this.data;
            document.open();
            try {
                let rendered = eval('`' + this.template + '`')
                document.write(rendered);
            } catch (e) {
                document.write(`
                    <html>
                    <body bgcolor="black">
                        <h1 style="color:cyan;">${e.message}</h1>
                        <h4 style="color:red;"><pre><code>${e.stack}</code></pre></h4>
                        <span style="position:absolute;bottom:32px;left:0;right:0;color:lime;text-align:center;">
                            sta-mina &copy 2018 Robin Duda
                        </span>
                    </body>
                    </html>
                `);
            }
            document.close();
        }
    }

    download((template) => { loaded({template: template}) }, 'templates/git-project.html');

    download((data) => {
        loaded({data: JSON.parse(data)});
    }, 'sites/' + location.search.split('=')[1] + '.json');

</script>
<body bgcolor="black"></body>
</html>
